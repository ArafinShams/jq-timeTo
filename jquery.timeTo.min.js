/**
 * TimeTo jQuery plug-in
 * Show countdown timer or realtime clock
 *
 * @author Alexey Teterin <altmoc@gmail.com>
 * @version 1.0.7
 * @license MIT http://opensource.org/licenses/MIT
 * @date 2013-10-27
 */
(function(e){if(typeof exports==="object"){var t=require("jquery");module.exports=e(t)}else if(typeof define==="function"&&define.amd){define(["jquery"],e)}else{e(t)}})(function(e){function r(e){var t=this.data(),n=this.find("ul");if(!t.vals||n.length===0)return;if(!e)e=t.seconds;var r=false;if(t.intervalId){r=true;clearTimeout(t.intervalId)}var s=Math.floor(e/86400),o=s*86400,u=Math.floor((e-o)/3600);o+=u*3600;var a=Math.floor((e-o)/60);o+=a*60;var f=e-o,l=(s<100?"0"+(s<10?"0":""):"")+s+(u<10?"0":"")+u+(a<10?"0":"")+a+(f<10?"0":"")+f;for(var c=t.vals.length-1,h=l.length-1,p;c>=0;c--,h--){p=parseInt(l.substr(h,1));t.vals[c]=p;n.eq(c).children().html(p)}if(r){var d=this;t.ttStartTime=Date.now();t.intervalId=setTimeout(function(){i.call(d)},1e3);this.data("intervalId",t.intervalId)}}function i(t){var n=this.find("ul"),r=this.data();if(!r.vals||n.length==0){if(r.intervalId){clearTimeout(r.intervalId);this.data("intervalId",null)}if(r.callback)r.callback();return}if(t==undefined){t=r.iSec}var s=r.vals[t],o=n.eq(t),u=o.children(),a=r.countdown?-1:1;u.eq(1).html(s);s+=a;if(t==r.iSec){var f=r.tickTimeout,l=(new Date).getTime()-r.ttStartTime;r.sec+=a;f+=Math.abs(r.seconds-r.sec)*f-l;r.intervalId=setTimeout(function(){i.call(c)},f)}if(s<0||s>r.limits[t]){if(s<0)s=r.limits[t];else s=0;if(t>0){i.call(this,t-1)}}u.eq(0).html(s);var c=this;if(e.support.transition){o.addClass("transition");o.css({top:0});setTimeout(function(){o.removeClass("transition");u.eq(1).html(s);o.css({top:"-"+r.height+"px"});if(a>0||t!=r.iSec)return;if(r.sec==r.countdownAlertLimit){n.parent().addClass("timeTo-alert")}if(r.sec===0){n.parent().removeClass("timeTo-alert");if(r.intervalId){clearTimeout(r.intervalId);c.data("intervalId",null)}if(typeof r.callback==="function")r.callback()}},410)}else{o.stop().animate({top:0},400,t!=r.iSec?null:function(){u.eq(1).html(s);o.css({top:"-"+r.height+"px"});if(a>0||t!=r.iSec)return;if(r.sec==r.countdownAlertLimit){n.parent().addClass("timeTo-alert")}else if(r.sec==0){n.parent().removeClass("timeTo-alert");if(r.intervalId){clearTimeout(r.intervalId);c.data("intervalId",null)}if(typeof r.callback==="function")r.callback()}})}r.vals[t]=s}var t={start:function(e){if(e)r.call(this,e);var t=this,n=setTimeout(function(){i.call(t)},1e3);this.data("ttStartTime",(new Date).getTime());this.data("intervalId",n)},stop:function(){var e=this.data();if(e.intervalId){clearTimeout(e.intervalId);this.data("intervalId",null)}return e},reset:function(e){var n=t.stop.call(this);this.find("div").css({backgroundPosition:"left center"});if(typeof e==="undefined")e=n.value;r.call(this,e)}};var n={en:{days:"days",hours:"hours",min:"minutes",sec:"seconds"},ru:{days:"дней",hours:"часов",min:"минут",sec:"секунд"},ua:{days:"днiв",hours:"годин",min:"хвилин",sec:"секунд"},de:{days:"Tag",hours:"Uhr",min:"Minuten",sec:"Secunden"},fr:{days:"jours",hours:"heures",min:"minutes",sec:"secondes"},sp:{days:"días",hours:"reloj",min:"minutos",sec:"segundos"},it:{days:"giorni",hours:"ore",min:"minuti",sec:"secondi"},nl:{days:"dagen",hours:"uren",min:"minuten",sec:"seconden"}};if(typeof e.support.transition==="undefined"){e.support.transition=function(){var e=document.body||document.documentElement,t=e.style,n=t.transition!==undefined||t.WebkitTransition!==undefined||t.MozTransition!==undefined||t.MsTransition!==undefined||t.OTransition!==undefined;return n}()}e.fn.timeTo=function(){var r={callback:null,captionSize:0,countdown:true,countdownAlertLimit:10,displayCaptions:false,displayDays:0,displayHours:true,fontFamily:"Verdana, sans-serif",fontSize:28,lang:"en",seconds:0,start:true,theme:"white",vals:[0,0,0,0,0,0,0,0,0],limits:[9,9,9,2,9,5,9,5,9],iSec:8,iHour:4,tickTimeout:1e3,intervalId:null},i,s={};for(var o=0,u;u=arguments[o];++o){if(o==0&&typeof u==="string"){i=u}else{if(typeof u=="object"){if(typeof u.getTime==="function"){s.timeTo=u}else{s=e.extend(s,u)}}else{if(typeof u=="function"){s.callback=u}else{var a=parseInt(u);if(!isNaN(a)){s.seconds=a}}}}}if(s.timeTo){var f,l=(new Date).getTime();if(s.timeTo.getTime){f=s.timeTo.getTime()}else if(typeof s.timeTo==="number"){f=s.timeTo}if(s.timeTo>l){s.seconds=Math.floor((f-l)/1e3)}}else if(s.time||!s.seconds){var f=s.time;if(!f)f=new Date;if(typeof f==="object"&&f.getTime){s.seconds=f.getHours()*3600+f.getMinutes()*60+f.getSeconds();s.countdown=false}else if(typeof f==="string"){var c=f.split(":"),h=0,p=1,d;while(d=c.pop()){h+=d*p;p*=60}s.seconds=h;s.countdown=false}}if(s.countdown!==false&&s.seconds>86400&&typeof s.displayDays==="undefined"){var v=Math.floor(s.seconds/86400);s.displayDays=v<10&&1||v<100&&2||3}else if(s.displayDays===true){s.displayDays=3}else if(s.displayDays){s.displayDays=s.displayDays>0?Math.floor(s.displayDays):3}return this.each(function(){var o=e(this),u=o.data(),a;if(!u.vals){u=e.extend(r,s);u.height=Math.round(u.fontSize*100/93);u.width=Math.round(u.fontSize*.8+u.height*.13);u.displayHours=!!(u.displayDays||u.displayHours);o.addClass("timeTo").addClass("timeTo-"+u.theme).css({fontFamily:u.fontFamily,fontSize:u.fontSize+"px"});var f=Math.round(u.height/10),l='<ul style="left:'+f+"px; top:-"+u.height+'px"><li>0</li><li>0</li></ul></div>',c=' style="width:'+u.width+"px; height:"+u.height+'px;"',h='<div class="first"'+c+">"+l,p="<div"+c+">"+l,d="<span>:</span>",v=Math.round(u.width*2+3),m=u.captionSize||Math.round(u.fontSize*.43);thtml=(u.displayCaptions?(u.displayHours?'<figure style="max-width:'+v+'px">$1<figcaption style="font-size:'+m+'px">'+n[u.lang].hours+"</figcaption></figure>"+d:"")+'<figure style="max-width:'+v+'px">$1<figcaption style="font-size:'+m+'px">'+n[u.lang].min+"</figcaption></figure>"+d+'<figure style="max-width:'+v+'px">$1<figcaption style="font-size:'+m+'px">'+n[u.lang].sec+"</figcaption></figure>":(u.displayHours?"$1"+d:"")+"$1"+d+"$1").replace(/\$1/g,h+p);if(u.displayDays>0){var g=u.fontSize*.4,y=h;for(a=u.displayDays-1;a>0;a--){y+=a===1?p.replace('">'," margin-right:"+Math.round(g)+'px">'):p}thtml=(u.displayCaptions?'<figure style="width:'+Math.round(u.width*u.displayDays+g+4)+'px">$1<figcaption style="font-size:'+m+"px; padding-right:"+Math.round(g)+'px">'+n[u.lang].days+"</figcaption></figure>":"$1").replace(/\$1/,y)+thtml}o.html(thtml)}else{if(u.intervalId){clearInterval(u.intervalId);u.intervalId=null}e.extend(u,s)}var b=o.find("div");if(b.length<u.vals.length){var w=u.vals.length-b.length,E=u.vals,S=u.limits;u.vals=[];u.limits=[];for(a=0;a<b.length;a++){u.vals[a]=E[w+a];u.limits[a]=S[w+a]}u.iSec=u.vals.length-1;u.iHour=u.vals.length-5}u.sec=u.seconds;o.data(u);if(i&&t[i]){t[i].call(o,u.seconds)}else if(u.start){t.start.call(o,u.seconds)}else{t.init.call(o,u.seconds)}})};return jQuery})
